CREATE TABLE Colleges (
  CollegeID INT PRIMARY KEY AUTO_INCREMENT,
  CollegeName VARCHAR(255) NOT NULL,
  CollegePassword VARCHAR(255) NOT NULL
);

CREATE TABLE Competitions (
  CompetitionID INT PRIMARY KEY AUTO_INCREMENT,
  CollegeID INT NOT NULL,
  CompetitionName VARCHAR(255) NOT NULL,
  StartDate DATETIME NOT NULL,
  EndDate DATETIME NOT NULL,
  InitialCash DECIMAL(10,2) NOT NULL,
  NumberOfParticipants INT NOT NULL,
  URL VARCHAR(255),
  FOREIGN KEY (CollegeID) REFERENCES Colleges(CollegeID)
);

CREATE TABLE Teams (
  TeamID INT PRIMARY KEY AUTO_INCREMENT,
  TeamPassword VARCHAR(255) NOT NULL,
  CompetitionID INT NOT NULL,
  TeamName VARCHAR(255) NOT NULL,
  Email VARCHAR(255),
  CurrentCash DECIMAL(10,2) NOT NULL DEFAULT 0,
  FOREIGN KEY (CompetitionID) REFERENCES Competitions(CompetitionID)
);

DELIMITER //
CREATE TRIGGER set_team_cash_before_insert
BEFORE INSERT ON Teams
FOR EACH ROW
BEGIN
  SET NEW.CurrentCash = (SELECT InitialCash FROM Competitions WHERE CompetitionID = NEW.CompetitionID);
END //
DELIMITER ;

CREATE TABLE Stocks (
  CompetitionID INT NOT NULL,
  StockSymbol VARCHAR(10) PRIMARY KEY,
  StockName VARCHAR(255) NOT NULL,
  InitialPrice DECIMAL(10,2) NOT NULL,
  CurrentPrice DECIMAL(10,2) NOT NULL,
  AvailableShares INT NOT NULL,
  BetaValue DECIMAL(10,2),
  SectorID INT NOT NULL,
  FOREIGN KEY (CompetitionID) REFERENCES Competitions(CompetitionID),
  FOREIGN KEY (SectorID) REFERENCES Sectors(SectorID)
);

CREATE TABLE Sectors (
  SectorID INT PRIMARY KEY AUTO_INCREMENT,
  SectorName VARCHAR(255) NOT NULL
);

CREATE TABLE Transactions (
  TransactionID INT PRIMARY KEY AUTO_INCREMENT,
  TeamID INT NOT NULL,
  StockSymbol VARCHAR(10) NOT NULL,
  TransactionType ENUM('BUY', 'SELL') NOT NULL,
  TransactionTime DATETIME NOT NULL,
  Price DECIMAL(10,2) NOT NULL,
  Quantity INT NOT NULL,
  FOREIGN KEY (TeamID) REFERENCES Teams(TeamID),
  FOREIGN KEY (StockSymbol) REFERENCES Stocks(StockSymbol)
);

INSERT INTO Colleges (CollegeName, CollegePassword) VALUES 
  ('NM College', 'password123'),
  ('DJSCE', 'password456');

INSERT INTO Competitions (CollegeID, CompetitionName, StartDate, EndDate, InitialCash, NumberOfParticipants, URL) VALUES
  (1, 'Mock Stock Tester', '2024-05-23 00:00:00', '2024-05-23 15:00:00', 10000.00, 10, 'https://basic.url.com/mockstocktester'),
  (2, 'Trading Competition', '2024-07-24 00:00:00', '2024-07-24 11:00:00', 5000.00, 5, 'https://basic.url.com/tradingcompetition');

INSERT INTO Teams (CompetitionID, TeamPassword, TeamName, Email) VALUES
  (1, 'team123', 'The Investment Club', 'invest@nm.edu'),
  (1, 'team456', 'The Wolf of Wall Street', 'wallstreet@nm.edu'),
  (2, 'team789', 'The Market Movers', 'movers@djsce.edu');

INSERT INTO Sectors (SectorName) VALUES
  ('Technology'),
  ('Healthcare'),
  ('Consumer Staples');

INSERT INTO Stocks (CompetitionID, StockSymbol, StockName, InitialPrice, CurrentPrice, AvailableShares, BetaValue, SectorID) VALUES
  (1, 'AAPL', 'Apple Inc.', 150.00, 150.00, 10000, 1.00, 1),
  (1, 'AMZN', 'Amazon.com Inc.', 120.00, 120.00, 8000, 1.20, 2),
  (2, 'TSLA', 'Tesla Inc.', 200.00, 200.00, 5000, 1.50, 1),
  (2, 'JNJ', 'Johnson & Johnson', 130.00, 130.00, 7000, 0.80, 3)
